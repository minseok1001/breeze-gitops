# GitOps 최소 구성 설정 파일 예시
# - 이 파일을 config.env로 복사해서 값을 채우세요.
#
#   cp scripts/gitops/config.env.example scripts/gitops/config.env
#   vi scripts/gitops/config.env
#

# =========================
# 공통
# =========================
# 서버 IP(비워두면 자동 감지 시도)
SERVER_IP=""

# 데이터/볼륨 저장 루트(권장: /srv 아래)
DATA_DIR="/srv/gitops-lab"

# 신규 인스턴스에서 자동으로 필수 패키지를 설치할지 여부
# - true : 01_preflight.sh에서 curl/jq/openssl/git 등 설치를 시도
# - false: 사용자가 직접 패키지 설치 후 진행
AUTO_INSTALL_PREREQS="true"

# =========================
# GitLab (선택)
# =========================
ENABLE_GITLAB="false"
GITLAB_HTTP_PORT="8080"
GITLAB_SSH_PORT="2222"
# GitLab 이미지(가능하면 버전 고정 권장)
GITLAB_IMAGE="gitlab/gitlab-ce:18.4.6-ce.0"
# 비워두면 스크립트가 랜덤 생성해서 .secrets에 저장
GITLAB_ROOT_PASSWORD=""
# GitLab 데이터 볼륨 사용 여부(권장)
# - false: 최소 구성(가장 단순/안정적). 컨테이너 재생성 시 데이터가 사라질 수 있음
# - true : DATA_DIR 아래에 볼륨 마운트(데이터 유지)
GITLAB_PERSIST_DATA="false"
# GitLab 내부 설정(omnibus) 최소 적용 여부
# - true : external_url/ssh 포트 등을 설정(링크/클론 URL이 더 정확해짐)
# - false: GitLab 기본값 사용(가장 단순/안정적)
GITLAB_APPLY_OMNIBUS_CONFIG="false"
# (선택) 외부 URL. 비워두면 http://SERVER_IP:GITLAB_HTTP_PORT 로 자동 설정
GITLAB_EXTERNAL_URL=""
# GitLab 초기 기동 대기 시간(초) - 설치/마이그레이션이 오래 걸릴 수 있음
GITLAB_STARTUP_TIMEOUT_SEC="1800"
# GitLab 컨테이너 /dev/shm 크기(PostgreSQL 등에 영향). 문제가 있으면 1g 이상 권장
GITLAB_SHM_SIZE="1g"

# GitLab API 자동화에 사용할 토큰(PAT, api scope)
# - GitOps 리포 자동 생성/시드(07_bootstrap_git_repo.sh)에 필요
GITLAB_TOKEN=""
GITLAB_GROUP_PATH=""          # 예: "lab" (비우면 사용자 네임스페이스)
GITLAB_PROJECT_NAME="gitops-demo"
GITLAB_PROJECT_PATH="gitops-demo"
GITLAB_DEFAULT_BRANCH="main"

# =========================
# Harbor (선택)
# =========================
ENABLE_HARBOR="false"
HARBOR_HTTP_PORT="8084"
# 레지스트리 주소(host:port). 비워두면 SERVER_IP:HARBOR_HTTP_PORT 로 자동 설정
HARBOR_REGISTRY_HOSTPORT=""
# Harbor 오프라인 설치 번들 경로(tgz). 비워두면 설치는 스킵되고, "이미 떠있다"를 전제로 진행 가능
HARBOR_OFFLINE_TGZ_PATH=""
# 설치 후 Harbor 접속 계정(기본 admin)
HARBOR_ADMIN_USER="admin"
# 비워두면 스크립트가 랜덤 생성해서 .secrets에 저장(새 설치 시)
HARBOR_ADMIN_PASSWORD=""

# =========================
# k3s (필수)
# =========================
K3S_VERSION="v1.34.2+k3s1"

# =========================
# Argo CD (필수)
# =========================
ARGOCD_VERSION="v3.2.1"
# Argo CD 설치 manifest 경로(폐쇄망이면 파일로 준비). 비워두면 GitHub raw URL을 사용
ARGOCD_MANIFEST_PATH=""
# NodePort로 외부 노출(기본 HTTPS 30443)
ARGOCD_NODEPORT_HTTPS="30443"

# =========================
# GitOps 데모 (선택)
# =========================
ENABLE_DEMO_APP="true"
DEMO_NAMESPACE="demo"
ARGOCD_APP_NAME="demo-app"
# demo 앱은 기본 nginx를 사용(레지스트리 설정 없이도 동작)
DEMO_IMAGE="nginx:1.29.4-alpine"

# Argo CD가 바라볼 Git 리포지토리 정보
# - 07_bootstrap_git_repo.sh를 성공적으로 실행했다면 자동으로 채워집니다.
# - GitLab을 사용하지 않거나 수동으로 리포를 준비했다면 아래 값을 직접 입력하세요.
GITOPS_REPO_URL=""
GITOPS_TARGET_REVISION="main"
GITOPS_REPO_PATH="apps/demo-app"

# (선택) 리포가 private인 경우 Argo CD에 등록할 인증 정보
# - GitLab PAT를 쓰는 경우: username=oauth2, password=PAT 권장
GITOPS_REPO_USERNAME=""
GITOPS_REPO_PASSWORD=""
